(()=>{const k=function(e){return new Promise(t=>{var n=document.createElement("script");n.src=e,n.onload=()=>{t()},document.head.appendChild(n)})},P=function(e){return new Promise(t=>{var n=document.createElement("link");n.href=e,n.type="text/css",n.rel="stylesheet",n.onload=()=>{t()},document.head.appendChild(n)})};var N=function(e){for(var t=function(l){for(var s=l.childNodes,a=s.length,y=[],u,v,p,h,g=0;g<a;g++){if(u=s[g],u.nodeType!==1)continue;v=u.children[0],p=v.getAttribute("data-size").split("x"),h={src:v.getAttribute("href"),w:parseInt(p[0],10),h:parseInt(p[1],10)},u.children.length>1&&(h.title=u.children[1].innerHTML),v.children.length>0&&(h.msrc=v.children[0].getAttribute("src")),h.el=u,y.push(h)}return y},n=function l(s,a){return s&&(a(s)?s:l(s.parentNode,a))},i=function(l){l=l||window.event,l.preventDefault?l.preventDefault():l.returnValue=!1;var s=l.target||l.srcElement,a=n(s,function(w){return w.tagName&&w.tagName.toUpperCase()==="FIGURE"});if(!a)return;for(var y=a.parentNode,u=a.parentNode.childNodes,v=u.length,p=0,h,g=0;g<v;g++){if(u[g].nodeType!==1)continue;if(u[g]===a){h=p;break}p++}return h>=0&&c(h,y),!1},d=function(){var l=window.location.hash.substring(1),s={};if(l.length<5)return s;for(var a=l.split("&"),y=0;y<a.length;y++){if(!a[y])continue;var u=a[y].split("=");if(u.length<2)continue;s[u[0]]=u[1]}return s.gid&&(s.gid=parseInt(s.gid,10)),s},c=function(l,s,a,y){var u=document.querySelectorAll(".pswp")[0],v,p,h;if(h=t(s),p={galleryUID:s.getAttribute("data-pswp-uid"),getThumbBoundsFn:function(w){var A=h[w].el.getElementsByTagName("img")[0],D=window.pageYOffset||document.documentElement.scrollTop,S=A.getBoundingClientRect();return{x:S.left,y:S.top+D,w:S.width}}},y)if(p.galleryPIDs){for(var g=0;g<h.length;g++)if(h[g].pid==l){p.index=g;break}}else p.index=parseInt(l,10)-1;else p.index=parseInt(l,10);if(isNaN(p.index))return;a&&(p.showAnimationDuration=0),v=new PhotoSwipe(u,PhotoSwipeUI_Default,h,p),v.init()},f=document.querySelectorAll(e),o=0,r=f.length;o<r;o++)f[o].setAttribute("data-pswp-uid",o+1),f[o].onclick=i;var m=d();m.pid&&m.gid&&c(m.pid,f[m.gid-1],!0,!0)};function C(e){let t=document.createElement("div");t.className="gallery";let n=e[0].parentNode,i=e[0];n.insertBefore(t,i);for(let d=0;d<e.length;++d){const c=e[d].querySelector("img").width,f=e[d].querySelector("img").height;e[d].style.flexGrow=`${c*100/f}`,e[d].style.flexBasis=`${c*240/f}px`,t.appendChild(e[d])}}function B(){const e=[k("https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"),k("https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"),P("https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"),P("https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css")];return Promise.all(e)}function L(e){const t=document.querySelector(e).querySelectorAll("figure");if(t.length){let n=[t[0]];for(let i=1;i<t.length;++i)t[i].previousElementSibling===n[n.length-1]?n.push(t[i]):(C(n),n=[t[i]]);n.length>0&&C(n),B().then(()=>{const i=document.querySelector(".pswp");i.style.removeProperty("display"),N(`${e} .gallery`)})}}let b={};if(localStorage.hasOwnProperty("StackColorsCache"))try{b=JSON.parse(localStorage.getItem("StackColorsCache"))}catch(e){b={}}async function x(e,t,n){if(!e)return await Vibrant.from(n).getPalette();if(!b.hasOwnProperty(e)||b[e].hash!==t){const i=await Vibrant.from(n).getPalette();b[e]={hash:t,Vibrant:{hex:i.Vibrant.hex,rgb:i.Vibrant.rgb,bodyTextColor:i.Vibrant.bodyTextColor},DarkMuted:{hex:i.DarkMuted.hex,rgb:i.DarkMuted.rgb,bodyTextColor:i.DarkMuted.bodyTextColor}},localStorage.setItem("StackColorsCache",JSON.stringify(b))}return b[e]}let M=(e,t=500)=>{e.classList.add("transiting"),e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height=e.offsetHeight+"px",e.offsetHeight,e.style.overflow="hidden",e.style.height="0",e.style.paddingTop="0",e.style.paddingBottom="0",e.style.marginTop="0",e.style.marginBottom="0",window.setTimeout(()=>{e.classList.remove("show"),e.style.removeProperty("height"),e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property"),e.classList.remove("transiting")},t)},q=(e,t=500)=>{e.classList.add("transiting"),e.style.removeProperty("display"),e.classList.add("show");let n=e.offsetHeight;e.style.overflow="hidden",e.style.height="0",e.style.paddingTop="0",e.style.paddingBottom="0",e.style.marginTop="0",e.style.marginBottom="0",e.offsetHeight,e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height=n+"px",e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),window.setTimeout(()=>{e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property"),e.classList.remove("transiting")},t)},H=(e,t=500)=>window.getComputedStyle(e).display==="none"?q(e,t):M(e,t);function E(){const e=document.getElementById("toggle-menu");e&&e.addEventListener("click",()=>{if(document.getElementById("main-menu").classList.contains("transiting"))return;document.body.classList.toggle("show-menu"),H(document.getElementById("main-menu"),300),e.classList.toggle("is-active")})}async function T(){let e;document.querySelector(".input-search")&&R(document.querySelector(".input-search"))}async function V(e,t){let n=[],i=[];for(var d=0;d<e.length;d++){let c=e[d];if(c.content.length==0)continue;c.title.toLowerCase().includes(t)?n.push(c):c.content.toLowerCase().includes(t)&&i.push(c)}return n.length>1?Promise.resolve(n):Promise.resolve(n.concat(i))}async function j(e,t){let n=[];return n=n.concat(await V(e,t)),Promise.resolve(n)}async function R(e){let t,n=0,i=await(await fetch("/index.json")).json();e.addEventListener("input",async function(){let o,r;if(e.value.length>2){t=-1;let m=await j(i,e.value.toLowerCase());if(n=m.length,m.length>0){f(),o=document.createElement("div"),o.setAttribute("id","autocomplete-list"),o.setAttribute("class","autocomplete-items"),this.parentNode.appendChild(o);for(let l=0;l<m.length;l++){let s=m[l];r=document.createElement("div"),r.innerHTML="<strong>"+s.title+"</strong></br>",r.innerHTML+=s.content.substring(0,20)+"...",r.addEventListener("click",function(a){window.location=s.permalink}.bind(s)),o.appendChild(r)}}}}),e.addEventListener("keydown",function(o){var r=document.getElementById("autocomplete-list");r&&(r=r.getElementsByTagName("div")),o.keyCode==40&&t<n?(t++,d(r)):o.keyCode==38&&t>0?(t--,d(r)):o.keyCode==13&&(o.preventDefault(),t>-1&&(r&&r[t].click()))});function d(o){if(!o)return!1;c(o),t>=o.length&&(t=0),t<0&&(t=o.length-1),o[t].classList.add("autocomplete-active")}function c(o){for(var r=0;r<o.length;r++)o[r].classList.remove("autocomplete-active")}function f(o){for(var r=document.getElementsByClassName("autocomplete-items"),m=0;m<r.length;m++)o!=r[m]&&o!=e&&r[m].parentNode.removeChild(r[m])}document.addEventListener("click",function(o){f(o.target)})}let I={init:()=>{E(),T(),document.querySelector(".article-content")&&L(".article-content"),document.querySelectorAll(".color-tag").forEach(async t=>{const n=t.getAttribute("data-image"),i=t.getAttribute("data-key"),d=t.getAttribute("data-hash"),c=await x(i,d,n);t.style.color=c.Vibrant.bodyTextColor,t.style.background=c.Vibrant.hex});const e=document.querySelector(".article-list--tile");if(e){let t=new IntersectionObserver(async(n,i)=>{n.forEach(d=>{if(!d.isIntersecting)return;i.unobserve(d.target);const c=d.target.querySelectorAll("article.has-image");c.forEach(async f=>{const o=f.querySelector("img"),r=o.src,m=o.getAttribute("data-key"),l=o.getAttribute("data-hash"),s=f.querySelector(".article-details"),a=await x(m,l,r);s.style.background=`
                        linear-gradient(0deg,
                            rgba(${a.DarkMuted.rgb[0]}, ${a.DarkMuted.rgb[1]}, ${a.DarkMuted.rgb[2]}, 0.5) 0%,
                            rgba(${a.Vibrant.rgb[0]}, ${a.Vibrant.rgb[1]}, ${a.Vibrant.rgb[2]}, 0.75) 100%)`})})});t.observe(e)}}};window.addEventListener("load",()=>{setTimeout(function(){I.init()},0)});window.Stack=I;})();
/*!
*   Hugo Theme Stack
*
*   @author: Jimmy Cai
*   @website: https://jimmycai.com
*   @link: https://github.com/CaiJimmy/hugo-theme-stack
*/
